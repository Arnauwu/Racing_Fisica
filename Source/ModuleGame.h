#pragma once

#include "Globals.h"
#include "Module.h"
#include "Entity.h"
#include "Player.h"
#include "Enemy.h"

#include "p2Point.h"

#include "raylib.h"
#include <vector>
#include <set>

class ModuleGame : public Module
{
public:
	enum class Maps
	{
		MOSS_GROTTO_1,
		MOSS_GROTTO_2,
		CRYSTAL_PEAK_1,
		CRYSTAL_PEAK_2,
		BELLHART_1,
		BELLHART_2
	};
	Maps map;
	Screens currentScreen;

	ModuleGame(Application* app, bool start_enabled = true);
	~ModuleGame();

	bool Start();
	update_status Update();
	bool CleanUp();
	void OnCollision(PhysBody* bodyA, PhysBody* bodyB);
	void LoadMap(Maps _map);
	void carSetup(Car* _car, Characters* _char);

	void LoadScreen();
	void UnloadGame();
	void SetCamera(float zoom, Vector2 offset, Vector2 target);
	void SetUpCars();
	void CalculatePositions();
	void DrawWorms();

public:

	std::vector<Entity*> entities;
	std::vector<Enemy*> enemies;
	std::vector<Car*> cars;
	std::vector<Car> carsRanking;

	PhysBody* sensor;
	bool sensed;

	Texture2D circle;
	Texture2D box;

	uint32 optSelectFx;
	uint32 moveMenuFx;
	uint32 winFX;
	uint32 looseFX;
	uint32 turboFx;

	vec2<int> ray;
	bool ray_on;

	std::set<std::set<Entity*>> collidingEntities;

	ModulePlayer* player;
	Enemy* enemy1;
	Enemy* enemy2;
	Enemy* enemy3;
	Enemy* enemy4;
	Enemy* enemy5;

	PhysBody* INTERIOR;
	PhysBody* EXTERIOR;
	PhysBody* EXTRAS = nullptr;
	PhysBody* CheckPoint1;
	PhysBody* CheckPoint2;
	PhysBody* CheckPoint3;
	PhysBody* CheckPoint4;

	int selected = 1;
	double playerTime;
	double* bestTime;
	double bestTimeM1;
	double bestTimeM2;
	double bestTimeC1;
	double bestTimeC2;

	int playerLaps;
	std::vector<Vector2> wormsPos;

	ModuleAudio* audio;

	std::vector<PhysBody*> worms;
	std::vector<PhysBody*> toDelete;
	Texture2D wormTEXT;


#pragma region maps
	const int MossGrottoEXT[196] = {
72, 237,
71, 917,
102, 920,
106, 952,
134, 954,
140, 985,
170, 986,
173, 1044,
195, 1051,
204, 1078,
259, 1083,
265, 1108,
290, 1109,
297, 1141,
325, 1144,
329, 1175,
356, 1175,
363, 1207,
516, 1208,
523, 1237,
1043, 1239,
1044, 1210,
1141, 1208,
1142, 1180,
1172, 1174,
1174, 1144,
1205, 1138,
1205, 1084,
1236, 1077,
1238, 1017,
1271, 1012,
1266, 719,
1235, 713,
1235, 686,
1201, 682,
1197, 621,
1174, 613,
1172, 573,
1205, 561,
1205, 507,
1234, 504,
1236, 374,
1267, 374,
1268, 240,
1240, 230,
1235, 107,
1205, 101,
1205, 74,
1174, 72,
1172, 42,
1109, 36,
1108, 9,
810, 12,
811, 37,
749, 42,
743, 72,
717, 73,
709, 169,
686, 170,
680, 197,
654, 202,
652, 598,
680, 599,
681, 630,
712, 632,
711, 645,
686, 652,
680, 677,
498, 680,
502, 653,
469, 650,
470, 630,
498, 630,
505, 601,
533, 598,
537, 570,
565, 567,
565, 537,
598, 535,
601, 506,
627, 500,
629, 209,
599, 202,
595, 141,
566, 137,
564, 106,
531, 102,
534, 73,
501, 68,
500, 40,
202, 42,
202, 72,
174, 74,
167, 102,
143, 104,
133, 163,
106, 171,
104, 230
	};
	const int MossGrottoINT[156] = {
	311, 278,
	309, 249,
	354, 248,
	362, 277,
	388, 280,
	392, 309,
	419, 313,
	421, 418,
	395, 426,
	389, 454,
	364, 457,
	361, 487,
	329, 492,
	326, 513,
	294, 525,
	299, 726,
	329, 730,
	330, 759,
	357, 761,
	360, 820,
	391, 824,
	395, 858,
	418, 857,
	431, 887,
	789, 883,
	788, 861,
	821, 857,
	820, 827,
	853, 820,
	853, 793,
	883, 786,
	883, 557,
	851, 551,
	852, 526,
	821, 520,
	821, 493,
	786, 487,
	788, 346,
	821, 338,
	822, 313,
	852, 307,
	852, 218,
	879, 219,
	884, 185,
	966, 185,
	972, 214,
	999, 217,
	1000, 246,
	1028, 246,
	1032, 305,
	1061, 312,
	1061, 323,
	1040, 328,
	1030, 391,
	999, 394,
	998, 447,
	972, 465,
	968, 518,
	938, 523,
	941, 721,
	964, 732,
	970, 791,
	998, 795,
	1001, 899,
	972, 908,
	966, 933,
	851, 932,
	853, 909,
	341, 902,
	339, 880,
	305, 871,
	307, 843,
	279, 839,
	269, 813,
	248, 809,
	245, 311,
	272, 312,
	279, 281
	};
	int CrystalPeakEXT[174] = {
	7, 140,
	7, 1170,
	35, 1177,
	41, 1201,
	68, 1208,
	71, 1237,
	101, 1241,
	105, 1268,
	402, 1270,
	405, 1241,
	434, 1237,
	438, 1205,
	467, 1207,
	468, 1175,
	498, 1171,
	501, 472,
	530, 470,
	532, 440,
	561, 435,
	565, 405,
	621, 400,
	631, 377,
	740, 375,
	745, 405,
	802, 410,
	805, 421,
	918, 422,
	802, 431,
	804, 454,
	711, 455,
	708, 487,
	615, 488,
	612, 520,
	551, 520,
	547, 545,
	520, 555,
	518, 805,
	692, 810,
	515, 814,
	520, 882,
	550, 890,
	554, 914,
	584, 917,
	587, 945,
	644, 952,
	648, 978,
	677, 985,
	680, 1010,
	707, 1017,
	714, 1041,
	741, 1047,
	747, 1072,
	777, 1081,
	780, 1107,
	805, 1111,
	812, 1140,
	838, 1144,
	842, 1170,
	870, 1175,
	874, 1201,
	901, 1208,
	904, 1235,
	932, 1241,
	937, 1270,
	1232, 1270,
	1237, 1242,
	1265, 1234,
	1267, 621,
	1187, 614,
	1265, 605,
	1267, 77,
	1235, 71,
	1235, 42,
	1201, 40,
	1201, 5,
	234, 10,
	230, 118,
	218, 7,
	134, 11,
	132, 41,
	105, 40,
	101, 71,
	68, 74,
	68, 95,
	35, 105,
	37, 132,
	15, 135
	};
	int CrystalPeakINT[168] = {
		180, 1032,
		181, 345,
		101, 330,
		212, 337,
		214, 310,
		242, 301,
		241, 277,
		272, 268,
		271, 244,
		302, 237,
		305, 211,
		337, 204,
		337, 180,
		427, 175,
		431, 151,
		998, 147,
		1005, 174,
		1034, 182,
		1037, 207,
		1065, 211,
		1070, 268,
		1095, 277,
		1097, 551,
		1067, 561,
		1061, 802,
		1144, 812,
		1058, 817,
		1065, 905,
		1041, 907,
		1037, 875,
		978, 875,
		978, 845,
		801, 840,
		945, 831,
		941, 808,
		917, 808,
		908, 780,
		882, 777,
		874, 751,
		850, 748,
		850, 714,
		778, 715,
		782, 695,
		814, 688,
		818, 662,
		944, 660,
		944, 631,
		977, 627,
		980, 601,
		1008, 595,
		1011, 570,
		1040, 565,
		1042, 538,
		1075, 530,
		1074, 300,
		1041, 298,
		1041, 267,
		1010, 267,
		1011, 235,
		977, 238,
		978, 205,
		945, 204,
		944, 171,
		491, 171,
		488, 195,
		455, 205,
		454, 230,
		424, 234,
		427, 262,
		390, 268,
		394, 292,
		360, 301,
		361, 327,
		330, 331,
		325, 1031,
		298, 1035,
		291, 1062,
		265, 1068,
		260, 1097,
		241, 1094,
		242, 1064,
		215, 1065,
		211, 1032,
		190, 1032
	};

	int MossGrotto_2EXT[134] = {
	8, 76,
	6, 1268,
	38, 1276,
	40, 1335,
	1396, 1338,
	1395, 1307,
	1427, 1301,
	1427, 1272,
	1456, 1266,
	1463, 1244,
	1492, 1236,
	1490, 1209,
	1521, 1201,
	1520, 973,
	1493, 969,
	1489, 938,
	1463, 935,
	1458, 903,
	1427, 906,
	1423, 872,
	1392, 870,
	1387, 838,
	564, 838,
	564, 823,
	1387, 818,
	1395, 795,
	1426, 789,
	1427, 761,
	1458, 758,
	1466, 729,
	1490, 724,
	1495, 696,
	1521, 696,
	1520, 460,
	1498, 456,
	1492, 430,
	1463, 423,
	1456, 398,
	1424, 393,
	1421, 367,
	1396, 361,
	1387, 330,
	1360, 326,
	1355, 303,
	1324, 293,
	1324, 270,
	1300, 263,
	1295, 238,
	1272, 236,
	1267, 206,
	1232, 198,
	1227, 173,
	1204, 170,
	1198, 138,
	1170, 138,
	1168, 105,
	1134, 105,
	1137, 74,
	1102, 74,
	1100, 45,
	1074, 41,
	1068, 8,
	74, 11,
	71, 37,
	40, 45,
	40, 71,
	15, 72
	};

	int MossGrotto_2INT[78] = {
	242, 244,
	265, 246,
	268, 436,
	295, 439,
	297, 469,
	324, 471,
	331, 502,
	358, 505,
	359, 534,
	390, 534,
	396, 566,
	1221, 567,
	1219, 583,
	398, 588,
	390, 615,
	359, 623,
	359, 646,
	330, 652,
	327, 676,
	297, 685,
	293, 714,
	267, 714,
	271, 953,
	295, 953,
	300, 985,
	329, 983,
	331, 1013,
	356, 1014,
	361, 1044,
	392, 1050,
	392, 1073,
	1221, 1080,
	1219, 1094,
	309, 1093,
	307, 1071,
	275, 1062,
	274, 972,
	246, 965,
	240, 249
	};

	int MossGrotto_2EXTRAS[38] = {
	498, 214,
	868, 213,
	874, 245,
	901, 245,
	905, 277,
	935, 279,
	939, 310,
	965, 312,
	970, 341,
	1000, 345,
	998, 359,
	596, 360,
	592, 333,
	561, 329,
	560, 270,
	529, 261,
	528, 236,
	495, 233,
	496, 219
	};

	int CrystalPeak_2EXT[158] = {
	6, 490,
	5, 1206,
	38, 1208,
	37, 1236,
	73, 1238,
	70, 1270,
	404, 1270,
	404, 1241,
	434, 1237,
	436, 1208,
	468, 1201,
	469, 886,
	498, 881,
	498, 856,
	520, 856,
	520, 886,
	552, 889,
	552, 1202,
	581, 1206,
	582, 1237,
	616, 1238,
	616, 1269,
	946, 1269,
	949, 1241,
	978, 1236,
	978, 1209,
	1008, 1205,
	1010, 924,
	1041, 914,
	1045, 888,
	1072, 885,
	1074, 854,
	1106, 850,
	1109, 825,
	1229, 818,
	1234, 793,
	1266, 789,
	1265, 522,
	1238, 520,
	1232, 492,
	1108, 493,
	1105, 458,
	1073, 461,
	1074, 425,
	1041, 426,
	1036, 393,
	1014, 392,
	1009, 140,
	981, 138,
	978, 108,
	949, 104,
	946, 74,
	916, 72,
	914, 42,
	885, 44,
	882, 9,
	105, 13,
	101, 40,
	72, 44,
	69, 76,
	38, 77,
	38, 100,
	6, 108,
	9, 276,
	38, 277,
	42, 304,
	70, 312,
	74, 341,
	102, 344,
	106, 372,
	485, 376,
	485, 392,
	105, 393,
	101, 422,
	73, 426,
	70, 454,
	42, 456,
	36, 486,
	12, 488
	};

	int CrystalPeak_2INT[134] = {
	276, 185,
	645, 184,
	648, 213,
	678, 213,
	680, 244,
	713, 248,
	710, 277,
	742, 281,
	742, 469,
	772, 470,
	772, 502,
	806, 504,
	806, 533,
	836, 538,
	840, 566,
	865, 568,
	874, 597,
	996, 600,
	997, 632,
	1028, 630,
	1029, 646,
	1000, 649,
	997, 677,
	872, 682,
	870, 709,
	841, 710,
	840, 741,
	808, 742,
	804, 772,
	776, 778,
	776, 1062,
	754, 1062,
	758, 681,
	726, 678,
	726, 649,
	696, 646,
	690, 614,
	328, 618,
	328, 646,
	296, 650,
	296, 681,
	264, 685,
	261, 1062,
	242, 1065,
	244, 665,
	276, 660,
	274, 630,
	308, 629,
	306, 602,
	337, 600,
	338, 568,
	624, 562,
	628, 534,
	658, 533,
	658, 506,
	688, 500,
	692, 474,
	720, 472,
	722, 298,
	694, 301,
	693, 268,
	661, 268,
	658, 237,
	629, 237,
	629, 204,
	276, 204,
	273, 189
	};

#pragma endregion
};
