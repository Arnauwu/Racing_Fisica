#pragma once

#include "Globals.h"
#include "Module.h"
#include "Entity.h"
#include "Player.h"
#include "Enemy.h"

#include "p2Point.h"

#include "raylib.h"
#include <vector>
#include <set>

class ModuleGame : public Module
{
public:
	enum class Maps
	{
		MOSS_GROTTO_1,
		MOSS_GROTTO_2,
		CRYSTAL_PEAK_1,
		CRYSTAL_PEAK_2,
		BELLHART_1,
		BELLHART_2
	};
	Maps map;
	Screens currentScreen;

	ModuleGame(Application* app, bool start_enabled = true);
	~ModuleGame();

	bool Start();
	update_status Update();
	bool CleanUp();
	void OnCollision(PhysBody* bodyA, PhysBody* bodyB);
	void LoadMap(Maps _map);
	void carSetup(Car* _car, Characters* _char);

	void LoadScreen();
	void UnloadGame();
	void SetCamera(float zoom, Vector2 offset, Vector2 target);

public:

	std::vector<Entity*> entities;

	PhysBody* sensor;
	bool sensed;

	Texture2D circle;
	Texture2D box;

	uint32 bonus_fx;

	vec2<int> ray;
	bool ray_on;

	std::set<std::set<Entity*>> collidingEntities;

	ModulePlayer* player;
	Enemy* enemy1;

	PhysBody* INTERIOR;
	PhysBody* EXTERIOR;
	PhysBody* CheckPoint1;
	PhysBody* CheckPoint2;
	PhysBody* CheckPoint3;
	PhysBody* CheckPoint4;

	



#pragma region maps
	const int MossGrottoEXT[196] = {
72, 237,
71, 917,
102, 920,
106, 952,
134, 954,
140, 985,
170, 986,
173, 1044,
195, 1051,
204, 1078,
259, 1083,
265, 1108,
290, 1109,
297, 1141,
325, 1144,
329, 1175,
356, 1175,
363, 1207,
516, 1208,
523, 1237,
1043, 1239,
1044, 1210,
1141, 1208,
1142, 1180,
1172, 1174,
1174, 1144,
1205, 1138,
1205, 1084,
1236, 1077,
1238, 1017,
1271, 1012,
1266, 719,
1235, 713,
1235, 686,
1201, 682,
1197, 621,
1174, 613,
1172, 573,
1205, 561,
1205, 507,
1234, 504,
1236, 374,
1267, 374,
1268, 240,
1240, 230,
1235, 107,
1205, 101,
1205, 74,
1174, 72,
1172, 42,
1109, 36,
1108, 9,
810, 12,
811, 37,
749, 42,
743, 72,
717, 73,
709, 169,
686, 170,
680, 197,
654, 202,
652, 598,
680, 599,
681, 630,
712, 632,
711, 645,
686, 652,
680, 677,
498, 680,
502, 653,
469, 650,
470, 630,
498, 630,
505, 601,
533, 598,
537, 570,
565, 567,
565, 537,
598, 535,
601, 506,
627, 500,
629, 209,
599, 202,
595, 141,
566, 137,
564, 106,
531, 102,
534, 73,
501, 68,
500, 40,
202, 42,
202, 72,
174, 74,
167, 102,
143, 104,
133, 163,
106, 171,
104, 230
	};
	const int MossGrottoINT[156] = {
	311, 278,
	309, 249,
	354, 248,
	362, 277,
	388, 280,
	392, 309,
	419, 313,
	421, 418,
	395, 426,
	389, 454,
	364, 457,
	361, 487,
	329, 492,
	326, 513,
	294, 525,
	299, 726,
	329, 730,
	330, 759,
	357, 761,
	360, 820,
	391, 824,
	395, 858,
	418, 857,
	431, 887,
	789, 883,
	788, 861,
	821, 857,
	820, 827,
	853, 820,
	853, 793,
	883, 786,
	883, 557,
	851, 551,
	852, 526,
	821, 520,
	821, 493,
	786, 487,
	788, 346,
	821, 338,
	822, 313,
	852, 307,
	852, 218,
	879, 219,
	884, 185,
	966, 185,
	972, 214,
	999, 217,
	1000, 246,
	1028, 246,
	1032, 305,
	1061, 312,
	1061, 323,
	1040, 328,
	1030, 391,
	999, 394,
	998, 447,
	972, 465,
	968, 518,
	938, 523,
	941, 721,
	964, 732,
	970, 791,
	998, 795,
	1001, 899,
	972, 908,
	966, 933,
	851, 932,
	853, 909,
	341, 902,
	339, 880,
	305, 871,
	307, 843,
	279, 839,
	269, 813,
	248, 809,
	245, 311,
	272, 312,
	279, 281
	};
	int CrystalPeakEXT[174] = {
	7, 140,
	7, 1170,
	35, 1177,
	41, 1201,
	68, 1208,
	71, 1237,
	101, 1241,
	105, 1268,
	402, 1270,
	405, 1241,
	434, 1237,
	438, 1205,
	467, 1207,
	468, 1175,
	498, 1171,
	501, 472,
	530, 470,
	532, 440,
	561, 435,
	565, 405,
	621, 400,
	631, 377,
	740, 375,
	745, 405,
	802, 410,
	805, 421,
	918, 422,
	802, 431,
	804, 454,
	711, 455,
	708, 487,
	615, 488,
	612, 520,
	551, 520,
	547, 545,
	520, 555,
	518, 805,
	692, 810,
	515, 814,
	520, 882,
	550, 890,
	554, 914,
	584, 917,
	587, 945,
	644, 952,
	648, 978,
	677, 985,
	680, 1010,
	707, 1017,
	714, 1041,
	741, 1047,
	747, 1072,
	777, 1081,
	780, 1107,
	805, 1111,
	812, 1140,
	838, 1144,
	842, 1170,
	870, 1175,
	874, 1201,
	901, 1208,
	904, 1235,
	932, 1241,
	937, 1270,
	1232, 1270,
	1237, 1242,
	1265, 1234,
	1267, 621,
	1187, 614,
	1265, 605,
	1267, 77,
	1235, 71,
	1235, 42,
	1201, 40,
	1201, 5,
	234, 10,
	230, 118,
	218, 7,
	134, 11,
	132, 41,
	105, 40,
	101, 71,
	68, 74,
	68, 95,
	35, 105,
	37, 132,
	15, 135
	};
	int CrystalPeakINT[166] = {
	180, 345,
	178, 1033,
	210, 1040,
	210, 1062,
	244, 1069,
	245, 1098,
	260, 1093,
	266, 1065,
	292, 1065,
	296, 1037,
	326, 1033,
	326, 329,
	354, 332,
	361, 293,
	388, 297,
	393, 264,
	426, 264,
	420, 230,
	458, 233,
	454, 204,
	486, 197,
	488, 166,
	945, 169,
	946, 200,
	978, 204,
	980, 232,
	1008, 234,
	1013, 261,
	1041, 268,
	1042, 296,
	1077, 300,
	1076, 528,
	1045, 536,
	1041, 562,
	1008, 569,
	1004, 590,
	981, 596,
	973, 620,
	946, 629,
	941, 653,
	818, 661,
	813, 689,
	788, 694,
	785, 713,
	846, 714,
	849, 744,
	880, 749,
	882, 778,
	910, 780,
	913, 812,
	912, 830,
	801, 841,
	977, 844,
	977, 873,
	1041, 874,
	1038, 909,
	1060, 908,
	1061, 814,
	1148, 809,
	1061, 797,
	1062, 557,
	1096, 556,
	1094, 284,
	1066, 274,
	1062, 214,
	1034, 210,
	1030, 184,
	1001, 177,
	1002, 149,
	436, 149,
	430, 176,
	337, 178,
	334, 208,
	305, 208,
	305, 237,
	274, 244,
	273, 269,
	248, 278,
	240, 302,
	212, 310,
	209, 325,
	98, 325,
	162, 338
};


#pragma endregion
};
